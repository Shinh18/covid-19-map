{"version":3,"sources":["webpack:///./src/utils/dispatch.js","webpack:///./src/utils/config.js","webpack:///./src/utils/queries.js","webpack:///./src/map-layers.js","webpack:///./src/utils/constants.js","webpack:///./src/components/LeafletMap.js","webpack:///./src/components/InfoWindow.js","webpack:///./src/utils/data.js","webpack:///./src/index.js","webpack:///./src/utils/parse-hash.js","webpack:///./src/components/TitleDetails.js"],"names":["dispatch","d3","cartoSheetSyncTable","citiesCartoQuery","countiesCartoQuery","statesCartoQuery","countriesCartoQuery","rentStrikeIcon","L","Icon","iconUrl","iconSize","iconAnchor","className","mapLayersConfig","cities","name","type","query","queries","zIndex","props","layer","feature","properties","municipality","state","country","jurisdictionName","jurisdictionType","popupName","policyStrength","policyStrengthLanguage","range","style","color","strokeColorScale","colorNoData","fillColor","fillColorScale","fillOpacity","radius","pointRadius","weight","strokeWeight","pointToLayer","latlng","circleMarker","counties","county","states","admin","nations","name_en","rentStrikes","sheetId","marker","icon","window","undefined","defaultMapConfig","lat","lng","z","TOTAL_NUMBER_OF_MAP_LAYERS","Object","keys","length","isMobile","document","querySelector","offsetWidth","LeafletMap","config","Map","innerHTML","map","invalidateSize","closePopup","error","console","layerGroup","geojson","markerLayer","markerClusterGroup","key","layerConfig","data","self","geoJson","features","filter","Strike_Status","Latitude","Longitude","status","index","id","geometry","coordinates","maxClusterRadius","on","call","addLayer","bindPopup","template","Mustache","render","rentStrikePopupTemplate","Error","popupTemplate","dataLayers","set","addTo","fixZOrder","handleAllLayersAdded","size","forEach","layersControl","addOverlay","Array","from","values","sort","a","b","hasLayer","bringToFront","this","init","bindListeners","zoomControl","attributionControl","maxBounds","setView","control","attribution","prefix","addAttribution","zoom","position","layers","collapsed","basemapLayer","tileLayer","minZoom","maxZoom","resizeWindow","e","getElementById","classList","add","popup","_latlng","getZoom","animate","remove","setTimeout","addEventListener","clearTimeout","handleWindowResize","handleInfoWindowClose","handleAddLayer","handleLayerError","InfoWindow","infowindowContainer","infowindowTemplate","rentStrikeInfowindowTemplate","closeInfoWindow","cartoSqlApiBaseUri","handleFetchSuccess","handleFetchFailure","getCartoData","format","fetch","encodeURIComponent","res","ok","json","getSheetsData","text","csvParse","autoType","entries","mapConfig","input","location","hash","slice","split","inputVals","i","value","isNaN","parseInt","parseFloat","rentstrike","parseUriHash","titleDetails","open","toggleTitleDetails","openTitleDetails","closeTitleDetails","getData"],"mappings":"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","file":"index.ca73f19118611263a068.js","sourcesContent":["// d3-dispatch is a lightweight pub/sub module\n// for more see: https://github.com/d3/d3-dispatch\n\n// using dispatch.on() or dispatch.call() with one of the\n// following strings will respond or invoke an event\nconst events = [\n  \"fetch-map-data-resolve\",\n  \"fetch-map-data-reject\",\n  \"viewport-size\",\n  \"render-infowindow\",\n  \"close-infowindow\",\n  \"title-details-toggle\",\n  \"title-details-close\",\n  \"title-details-open\",\n];\n\n/**\n * dispatch usage:\n * dispatch.call(\"<event-name>\", <optional this context>, <optional value>);\n * dispatch.on(\"<event-name>\", <callback function>)\n * dispatch.on(\"<event-name.sub-name>\", <second callback function>)\n * dispatch.on(\"<event-name.sub-other-name>\", <third callback function>)\n * etc...\n */\nexport const dispatch = d3.dispatch(...events);\n","// unique id of the Google sheet that imports desired columns from the rent-strike form responses public sheet\nexport const renStrikeSheetId = \"1rCZfNXO3gbl5H3cKhGXKIv3samJ1KC4nLhCwwZqrHvU\";\n\n// name of AEMP's CARTO account\nexport const aempCartoAccount = \"ampitup\";\n\n// table in CARTO that syncs with the Google sheet data\nexport const cartoSheetSyncTable = \"public.emergency_tenant_protections_scored\";\nexport const cartoCountiesTable = \"public.us_county_boundaries\";\nexport const cartoStatesTable = \"public.states_and_provinces_global\";\nexport const cartoNationsTable = \"public.countries\";\n","import {\n  cartoSheetSyncTable,\n  cartoCountiesTable,\n  cartoStatesTable,\n  cartoNationsTable,\n} from \"./config\";\n\n/**\n * SQL queries that are passed to the CARTO SQL API\n * for more info on the SQL API see: https://carto.com/developers/sql-api/\n */\n\nexport const citiesCartoQuery = `\nSELECT\n  municipality, state, country, range, \n  policy_type, policy_summary, link, the_geom\nFROM ${cartoSheetSyncTable}\nWHERE the_geom is not null and admin_scale = 'City'\nORDER BY range`;\n\nexport const countiesCartoQuery = `\nSELECT\n  c.the_geom, c.county, c.state, m.range, \n  m.policy_type, m.policy_summary, m.link, m.range\nFROM ${cartoCountiesTable} c\nJOIN ${cartoSheetSyncTable} m\nON ST_Intersects(c.the_geom, m.the_geom)\nWHERE m.the_geom IS NOT NULL\n  AND m.admin_scale = 'County'\n  OR m.admin_scale = 'City and County'\nORDER BY m.range`;\n\nexport const statesCartoQuery = `\nSELECT\n  s.the_geom, s.name, s.admin, s.sr_adm0_a3,\n  m.range, m.iso, m .policy_type, m.policy_summary, m.link\nFROM ${cartoStatesTable} s\nINNER JOIN ${cartoSheetSyncTable} m\n  ON s.name = m.state\n  AND s.sr_adm0_a3 = m.iso\n  AND m.admin_scale = 'State'\nORDER BY m.range`;\n\nexport const countriesCartoQuery = `\nSELECT \n  c.the_geom, c.adm0_a3, c.name_en, m.range,\n  m.policy_type, m.policy_summary, m.link\nFROM ${cartoNationsTable} c\nINNER JOIN ${cartoSheetSyncTable} m\n  ON c.adm0_a3 = m.iso\n  AND m.admin_scale = 'Country'\nORDER BY m.range`;\n","import {\n  colorNoData,\n  fillColorScale,\n  strokeColorScale,\n  strokeWeight,\n  pointRadius,\n  fillOpacity,\n  policyStrengthLanguage,\n} from \"utils/constants\";\nimport { renStrikeSheetId } from \"./utils/config\";\nimport * as queries from \"./utils/queries\";\n\nconst rentStrikeIcon = new L.Icon({\n  iconUrl: \"./assets/mapIcons/rent-strike.svg\",\n  iconSize: [40, 40],\n  iconAnchor: [20, 20],\n  className: \"icon-rent-strike\",\n});\n\nexport const mapLayersConfig = {\n  cities: {\n    name: \"Cities\",\n    type: \"point\",\n    query: queries.citiesCartoQuery,\n    zIndex: 1,\n    props(layer) {\n      const { municipality, state, country } = layer.feature.properties;\n      return {\n        ...layer.feature.properties,\n        // Build city name with state and country if supplied\n        jurisdictionName: `${municipality}${state ? `, ${state}` : \"\"}${\n          country ? `, ${country}` : \"\"\n        }`,\n        jurisdictionType: \"City\",\n        popupName: municipality,\n        policyStrength: policyStrengthLanguage[layer.feature.properties.range],\n      };\n    },\n    style(feature) {\n      return {\n        color: strokeColorScale[feature.properties.range] || colorNoData,\n        fillColor: fillColorScale[feature.properties.range] || colorNoData,\n        fillOpacity: fillOpacity,\n        radius: pointRadius,\n        weight: strokeWeight,\n      };\n    },\n    pointToLayer(feature, latlng) {\n      return L.circleMarker(latlng, mapLayersConfig.cities.style(feature));\n    },\n  },\n\n  counties: {\n    name: \"Counties\",\n    type: \"polygon\",\n    query: queries.countiesCartoQuery,\n    zIndex: 2,\n    props(layer) {\n      const { state, county } = layer.feature.properties;\n      return {\n        ...layer.feature.properties,\n        // Show county with state if state field is set\n        jurisdictionName: `${county}${state ? `, ${state}` : \"\"}`,\n        jurisdictionType: \"County\",\n        popupName: `${county}${state ? `, ${state}` : \"\"}`,\n        policyStrength: policyStrengthLanguage[layer.feature.properties.range],\n      };\n    },\n    style(feature) {\n      return {\n        color: strokeColorScale[feature.properties.range] || colorNoData,\n        fillColor: fillColorScale[feature.properties.range] || colorNoData,\n        fillOpacity: fillOpacity,\n        radius: pointRadius,\n        weight: strokeWeight,\n      };\n    },\n  },\n\n  states: {\n    name: \"States\",\n    type: \"polygon\",\n    query: queries.statesCartoQuery,\n    zIndex: 3,\n    props(layer) {\n      const { name, admin } = layer.feature.properties;\n      return {\n        ...layer.feature.properties,\n        ...layer.feature.properties,\n        jurisdictionName: `${name}${admin ? `, ${admin}` : \"\"}`,\n        jurisdictionType: \"State/Province\",\n        popupName: name,\n        policyStrength: policyStrengthLanguage[layer.feature.properties.range],\n      };\n    },\n    style(feature) {\n      return {\n        color: strokeColorScale[feature.properties.range] || colorNoData,\n        fillColor: fillColorScale[feature.properties.range] || colorNoData,\n        fillOpacity: fillOpacity,\n        radius: pointRadius,\n        weight: strokeWeight,\n      };\n    },\n  },\n\n  nations: {\n    name: \"Nations\",\n    type: \"polygon\",\n    query: queries.countriesCartoQuery,\n    zIndex: 4,\n    props(layer) {\n      const { name_en } = layer.feature.properties;\n      return {\n        ...layer.feature.properties,\n        jurisdictionName: name_en,\n        jurisdictionType: \"Country\",\n        popupName: name_en,\n        policyStrength: policyStrengthLanguage[layer.feature.properties.range],\n      };\n    },\n\n    style(feature) {\n      return {\n        color: strokeColorScale[feature.properties.range] || colorNoData,\n        fillColor: fillColorScale[feature.properties.range] || colorNoData,\n        fillOpacity: fillOpacity,\n        radius: pointRadius,\n        weight: strokeWeight,\n      };\n    },\n  },\n\n  rentStrikes: {\n    name: \"Rent Strikes\",\n    type: \"marker-cluster\",\n    query: null,\n    sheetId: renStrikeSheetId,\n    zIndex: 0, // markers have their very own layer pane in Leaflet so don't need a z-index value\n    props(layer) {\n      return layer.feature.properties;\n    },\n    pointToLayer(feature, latlng) {\n      return L.marker(latlng, {\n        icon: rentStrikeIcon,\n      });\n    },\n  },\n};\n\nwindow.mapLayersConfig = mapLayersConfig;\n","import { mapLayersConfig } from \"../map-layers\";\n\n// color values come from this ColorBrewer url:\n// https://colorbrewer2.org/#type=sequential&scheme=YlGn&n=7\nexport const colorNoData = \"#939393\";\nexport const fillColorScale = [undefined, \"#d9f0a3\", \"#78c679\", \"#238443\"];\nexport const strokeColorScale = [undefined, \"#addd8e\", \"#41ab5d\", \"#005a32\"];\n\n// global map layer styling variables\nexport const strokeWeight = 1.5;\nexport const pointRadius = 8;\nexport const fillOpacity = 0.7;\n\n// corresponds to fill & stroke color scales above\nexport const policyStrengthLanguage = [\n  \"\",\n  \"Few protections in place\",\n  \"Some protections in place\",\n  \"Many protections in place\",\n];\n\n// note: this matches the breakpoint in styles.css\nexport const MOBILE_BREAKPOINT = 640;\nexport const DESKTOP_BREAKPOINT = 1200;\n\nexport const defaultMapConfig = {\n  lat: 40.67,\n  lng: -97.23,\n  z: 4,\n  nations: false,\n  states: true,\n  cities: true,\n  counties: true,\n  rentStrikes: true,\n};\n\nexport const TOTAL_NUMBER_OF_MAP_LAYERS = Object.keys(mapLayersConfig).length;\n\nexport const isMobile = () =>\n  document.querySelector(\"body\").offsetWidth < MOBILE_BREAKPOINT;\n","import { dispatch } from \"utils/dispatch\";\nimport {\n  defaultMapConfig,\n  isMobile,\n  TOTAL_NUMBER_OF_MAP_LAYERS,\n} from \"utils/constants\";\n\nexport class LeafletMap {\n  // dataLayers: look up table to store layer groups in the form of\n  // { layerGroup: <Leaflet layer group>, zIndex: <integer> }\n  dataLayers = new Map();\n\n  // Mustache templates for popup HTML\n  popupTemplate = document.querySelector(\".popup-template\").innerHTML;\n  rentStrikePopupTemplate = document.querySelector(\".rentstrike-popup-template\")\n    .innerHTML;\n\n  constructor(config) {\n    this.config = config || defaultMapConfig;\n    this.init();\n    this.bindListeners();\n  }\n\n  init() {\n    const { lat, lng, z } = this.config;\n\n    this.map = L.map(\"map\", {\n      zoomControl: false,\n      attributionControl: false,\n      maxBounds: [\n        [-85.05, -190], // lower left\n        [85.05, 200], // upper right\n      ],\n    });\n    this.map.setView([lat, lng], z);\n\n    this.attributionControl = L.control\n      .attribution({ prefix: \"Data sources by: \" })\n      .addAttribution(\n        \"<a href='https://www.antievictionmap.com/' target='_blank'>Anti-Eviction Mapping Project</a>\"\n      )\n      .addAttribution(\n        \"<a href='https://www.openstreetmap.org' target='_blank'>Open Street Map Contributors</a>\"\n      )\n      .addTo(this.map);\n\n    this.zoomControl = L.control\n      .zoom({ position: \"bottomright\" })\n      .addTo(this.map);\n\n    this.layersControl = L.control\n      .layers(null, null, { position: \"topright\", collapsed: false })\n      .addTo(this.map);\n\n    this.basemapLayer = L.tileLayer(\n      \"https://a.basemaps.cartocdn.com/rastertiles/light_all/{z}/{x}/{y}@2x.png\",\n      {\n        minZoom: 1,\n        maxZoom: 18,\n      }\n    ).addTo(this.map);\n  }\n\n  bindListeners() {\n    const self = this;\n    this.map.on(\"popupopen\", function (e) {\n      document.getElementById(\"root\").classList.add(\"aemp-popupopen\");\n\n      if (isMobile()) {\n        dispatch.call(\"title-details-close\");\n        self.map.invalidateSize();\n      }\n\n      self.map.setView(e.popup._latlng, self.map.getZoom(), { animate: true });\n    });\n\n    this.map.on(\"popupclose\", function () {\n      document.getElementById(\"root\").classList.remove(\"aemp-popupopen\");\n      dispatch.call(\"close-infowindow\");\n      if (isMobile())\n        setTimeout(function () {\n          self.map.invalidateSize();\n        }, 100);\n    });\n\n    this.map.on(\"click\", function () {\n      if (isMobile()) {\n        dispatch.call(\"title-details-close\");\n      }\n    });\n\n    // Apply correct relative order of layers when adding from control.\n    this.map.on(\"overlayadd\", () => {\n      this.fixZOrder();\n    });\n\n    let resizeWindow;\n    window.addEventListener(\"resize\", function () {\n      clearTimeout(resizeWindow);\n      resizeWindow = setTimeout(self.handleWindowResize, 250);\n    });\n\n    dispatch.on(\"close-infowindow.map\", this.handleInfoWindowClose);\n    dispatch.on(\"fetch-map-data-resolve.map\", this.handleAddLayer);\n    dispatch.on(\"fetch-map-data-reject.map\", this.handleLayerError);\n  }\n\n  handleWindowResize = () => {\n    if (isMobile()) {\n      this.map.invalidateSize();\n    }\n  };\n\n  handleInfoWindowClose = () => {\n    this.map.closePopup();\n    if (isMobile()) {\n      this.map.invalidateSize();\n    }\n  };\n\n  handleAddLayerError = (error) => {\n    console.error(error);\n  };\n\n  handleAddLayer = ({ key, layerConfig, data }) => {\n    const self = this;\n    let layerGroup;\n\n    switch (layerConfig.type) {\n      case \"point\":\n        layerGroup = handlePointLayer();\n        break;\n\n      case \"polygon\":\n        layerGroup = handlePolygonLayer();\n        break;\n\n      case \"marker-cluster\":\n        layerGroup = handleMarkerCluster();\n        break;\n\n      default:\n        throw Error(\"Unrecognized map layer type\");\n    }\n\n    function handlePointLayer() {\n      return L.geoJson(data, {\n        pointToLayer: layerConfig.pointToLayer,\n      });\n    }\n\n    function handlePolygonLayer() {\n      return L.geoJson(data, {\n        style(feature) {\n          return layerConfig.style(feature);\n        },\n      });\n    }\n\n    function handleMarkerCluster() {\n      // rent strikes data is regular JSON & requires additional parsing for conversion to GeoJSON\n      const geojson = {\n        type: \"FeatureCollection\",\n        features: data\n          .filter(\n            ({ Strike_Status, Latitude, Longitude }) =>\n              Strike_Status !== null && Longitude !== null && Latitude !== null\n          )\n          .map(({ Strike_Status, ...rest }) => ({\n            status:\n              Strike_Status === \"Yes / Sí / 是 / Oui\" || Strike_Status === \"Yes\"\n                ? \"Yes\"\n                : \"Unsure\",\n\n            ...rest,\n          }))\n          .map(({ Longitude, Latitude, ...rest }, index) => ({\n            type: \"Feature\",\n            id: index,\n            properties: rest,\n            geometry: {\n              type: \"Point\",\n              coordinates: [Longitude, Latitude],\n            },\n          })),\n      };\n\n      const markerLayer = L.geoJson(geojson, {\n        pointToLayer: layerConfig.pointToLayer,\n      });\n\n      const markerClusterGroup = L.markerClusterGroup({\n        maxClusterRadius: 40,\n      }).on(\"clusterclick\", function () {\n        if (isMobile()) {\n          dispatch.call(\"title-details-close\");\n        }\n      });\n\n      markerClusterGroup.addLayer(markerLayer).bindPopup(function (layer) {\n        dispatch.call(\"render-infowindow\", null, {\n          template: \"rentstrikes\",\n          data: layer.feature.properties,\n        });\n\n        return Mustache.render(\n          self.rentStrikePopupTemplate,\n          layerConfig.props(layer)\n        );\n      });\n\n      return markerClusterGroup;\n    }\n\n    if (layerConfig.type !== \"marker-cluster\") {\n      layerGroup.bindPopup(function (layer) {\n        const props = layerConfig.props(layer);\n        dispatch.call(\"render-infowindow\", null, {\n          template: \"protections\",\n          data: props,\n        });\n        return Mustache.render(self.popupTemplate, props);\n      });\n    }\n\n    this.dataLayers.set(layerConfig.name, {\n      layerGroup,\n      zIndex: layerConfig.zIndex,\n    });\n\n    if (this.config[key]) {\n      layerGroup.addTo(this.map);\n    }\n\n    this.fixZOrder();\n    this.handleAllLayersAdded();\n  };\n\n  handleAllLayersAdded = () => {\n    // if all layers have been added to this.dataLayers add the layers toggle UI\n    if (this.dataLayers.size !== TOTAL_NUMBER_OF_MAP_LAYERS) {\n      return;\n    }\n\n    this.dataLayers.forEach(({ layerGroup }, name) => {\n      this.layersControl.addOverlay(layerGroup, name);\n    });\n  };\n\n  fixZOrder = () => {\n    const layers = Array.from(this.dataLayers.values()).sort(\n      (a, b) => b.zIndex - a.zIndex\n    );\n    layers.forEach(({ layerGroup }) => {\n      if (this.map.hasLayer(layerGroup)) {\n        layerGroup.bringToFront();\n      }\n    });\n  };\n}\n","import { dispatch } from \"utils/dispatch\";\n\nexport class InfoWindow {\n  infowindowContainer = document.getElementById(\"aemp-infowindow-container\");\n\n  infowindowTemplate = document.getElementById(\"aemp-infowindow-template\")\n    .innerHTML;\n\n  rentStrikeInfowindowTemplate = document.getElementById(\n    \"aemp-rentstrike-infowindow-template\"\n  ).innerHTML;\n\n  constructor() {\n    this.bindListeners();\n  }\n\n  bindListeners() {\n    dispatch.on(\"render-infowindow\", this.render);\n    dispatch.on(\"close-infowindow.self\", this.closeInfoWindow);\n  }\n\n  closeInfoWindow = () => {\n    document.getElementById(\"root\").classList.remove(\"aemp-popupopen\");\n    this.infowindowContainer.innerHTML = null;\n  };\n\n  render = (props) => {\n    const { template, data } = props;\n    switch (template) {\n      case \"protections\":\n        this.infowindowContainer.innerHTML = Mustache.render(\n          this.infowindowTemplate,\n          data\n        );\n        break;\n      case \"rentstrikes\":\n        this.infowindowContainer.innerHTML = Mustache.render(\n          this.rentStrikeInfowindowTemplate,\n          data\n        );\n        break;\n      default:\n        break;\n    }\n    this.infowindowContainer\n      .querySelector(\".aemp-infowindow-close\")\n      .addEventListener(\"click\", () => dispatch.call(\"close-infowindow\"));\n    document.getElementById(\"root\").classList.add(\"aemp-popupopen\");\n  };\n}\n","import { aempCartoAccount } from \"./config\";\nimport { mapLayersConfig } from \"../map-layers\";\nimport { dispatch } from \"./dispatch\";\n\nconst cartoSqlApiBaseUri = `https://${aempCartoAccount}.carto.com/api/v2/sql`;\n\nfunction handleFetchSuccess(name, data) {\n  dispatch.call(name, null, data);\n}\n\nfunction handleFetchFailure(name, error) {\n  dispatch.call(name, null, error);\n}\n\nexport async function getCartoData(query, format = \"geojson\") {\n  const res = await fetch(\n    `${cartoSqlApiBaseUri}?q=${window.encodeURIComponent(\n      query\n    )}&format=${format}`\n  );\n\n  if (!res || !res.ok) {\n    throw Error(\"Unable to fetch Carto data\");\n  }\n\n  return res.json();\n}\n\nexport async function getSheetsData(sheetId) {\n  const res = await fetch(\n    `https://docs.google.com/spreadsheets/d/${sheetId}/export?format=csv&id=${sheetId}`\n  );\n\n  if (!res || !res.ok) {\n    throw Error(\"Unable to fetch sheets data\");\n  }\n\n  const text = await res.text();\n  return d3.csvParse(text, d3.autoType);\n}\n\nexport async function getData() {\n  for (let [key, layerConfig] of Object.entries(mapLayersConfig)) {\n    try {\n      const data =\n        layerConfig.query !== null\n          ? await getCartoData(layerConfig.query)\n          : await getSheetsData(layerConfig.sheetId);\n      handleFetchSuccess(\"fetch-map-data-resolve\", { key, layerConfig, data });\n    } catch (error) {\n      handleFetchFailure(\"fetch-map-data-reject\", error);\n    }\n  }\n}\n","import \"styles/index.scss\";\nimport { LeafletMap } from \"./components/LeafletMap\";\nimport { InfoWindow } from \"./components/InfoWindow\";\nimport { TitleDetails } from \"./components/TitleDetails\";\nimport { getData } from \"utils/data\";\nimport { parseUriHash } from \"utils/parse-hash\";\nimport { defaultMapConfig } from \"utils/constants\";\nimport { dispatch } from \"./utils/dispatch\";\n\nif (process.env.NODE_ENV !== \"production\") {\n  dispatch.on(\"fetch-map-data-resolve.debug\", console.log);\n  dispatch.on(\"fetch-map-data-reject.debug\", console.error);\n}\n\nconst mapConfig = parseUriHash(defaultMapConfig);\n\nnew LeafletMap(mapConfig);\nnew InfoWindow();\nnew TitleDetails();\n\ngetData();\n","/**\n * parseUriHash\n * Check the url hash for params then override map default settings if any are present.\n * assumes params are as follows:\n * #lat=<float>&lng=<float>&z=<integer>&states=<boolean>&cities=<boolean>&counties=<boolean>&rentstrike=<boolean>\n * @param {*} mapConfig\n */\nexport function parseUriHash(mapConfig) {\n  let input = window.location.hash.slice(1).split(\"&\");\n  let inputVals = {};\n  let i = 0;\n\n  for (i; i < input.length; i++) {\n    let [key, value] = input[i].split(\"=\");\n    inputVals[key] = value;\n  }\n\n  if (!isNaN(inputVals.z)) {\n    mapConfig.z = parseInt(inputVals.z);\n  }\n\n  if (!isNaN(inputVals.lat)) {\n    mapConfig.lat = parseFloat(inputVals.lat);\n  }\n\n  if (!isNaN(inputVals.lng)) {\n    mapConfig.lng = parseFloat(inputVals.lng);\n  }\n\n  if (inputVals.cities !== undefined) {\n    if (inputVals.cities === \"true\") {\n      mapConfig.cities = true;\n    } else if (inputVals.cities === \"false\") {\n      mapConfig.cities = false;\n    }\n  }\n\n  if (inputVals.counties !== undefined) {\n    if (inputVals.counties === \"true\") {\n      mapConfig.counties = true;\n    } else if (inputVals.counties === \"false\") {\n      mapConfig.counties = false;\n    }\n  }\n\n  if (inputVals.states !== undefined) {\n    if (inputVals.states === \"true\") {\n      mapConfig.states = true;\n    } else if (inputVals.states === \"false\") {\n      mapConfig.states = false;\n    }\n  }\n\n  if (inputVals.nations !== undefined) {\n    if (inputVals.nations === \"true\") {\n      mapConfig.nations = true;\n    } else if (inputVals.nations === \"false\") {\n      mapConfig.nations = false;\n    }\n  }\n\n  if (inputVals.rentstrike !== undefined) {\n    if (inputVals.rentstrike === \"true\") {\n      mapConfig.rentStrikes = true;\n    } else if (inputVals.rentstrike === \"false\") {\n      mapConfig.rentStrikes = false;\n    }\n  }\n}\n","import { dispatch } from \"utils/dispatch\";\n\n/**\n * TitleDetails: // the collapsable <details> element in the <header>\n */\nexport class TitleDetails {\n  titleDetails = document\n    .getElementById(\"aemp-titlebox\")\n    .querySelector(\"details\");\n\n  constructor() {\n    this.bindListeners();\n  }\n\n  bindListeners = () => {\n    this.titleDetails.addEventListener(\"toggle\", function () {\n      if (this.open) {\n        document.getElementById(\"aemp-titlebox\").classList.remove(\"collapsed\");\n      } else {\n        document.getElementById(\"aemp-titlebox\").classList.add(\"collapsed\");\n      }\n    });\n\n    dispatch.on(\"title-details-toggle\", this.toggleTitleDetails);\n    dispatch.on(\"title-details-open\", this.openTitleDetails);\n    dispatch.on(\"title-details-close\", this.closeTitleDetails);\n  };\n\n  closeTitleDetails = () => {\n    this.titleDetails.open = false;\n  };\n\n  openTitleDetails = () => {\n    this.titleDetails.open = true;\n  };\n\n  toggleTitleDetails = () => {\n    if (this.titleDetails.open) {\n      this.titleDetails.open = false;\n    } else {\n      this.titleDetails.open = true;\n    }\n  };\n}\n"],"sourceRoot":""}