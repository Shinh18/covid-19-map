(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{"sg+I":function(e,t,n){},tjUo:function(e,t,n){"use strict";n.r(t);n("sg+I"),n("pNMO"),n("TeQF"),n("QWBl"),n("pjDv"),n("4mDm"),n("2B1R"),n("ToJy"),n("sMBO"),n("Tskq"),n("5DmW"),n("27RR"),n("tkto"),n("07d7"),n("PKPk"),n("wgYD"),n("R3/m"),n("l/vG"),n("0q/z"),n("n5pg"),n("Q7Pz"),n("Vnov"),n("nIe3"),n("CUyW"),n("qc1c"),n("VOz1"),n("Thag"),n("9D6x"),n("FZtP"),n("3bBZ");var o=n("QILm"),i=n.n(o),r=n("lwsE"),a=n.n(r),s=n("W8MJ"),c=n.n(s),l=n("lSNA"),p=n.n(l),u=n("nbsC"),d=n.n(u),m=(n("zKZe"),Object.assign({},n("4R65"),n("JXP8"))),f=new m.Icon({iconUrl:"./assets/mapIcons/rent-strike.svg",iconSize:[40,40],iconAnchor:[20,20],className:"icon-rent-strike"}),y=m,h=n("xo8x").a.apply(void 0,["fetch-map-data-resolve","fetch-map-data-reject","viewport-size","render-infowindow","close-infowindow","title-details-toggle","title-details-close","title-details-open","show-loading-indicator","hide-loading-indicator"]),g=(n("ma9I"),"public.emergency_tenant_protections_scored");function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach((function(t){p()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var v={cities:{name:"Cities",type:"point",query:"\nSELECT\n  municipality, state, country, range, \n  policy_type, policy_summary, link, the_geom\nFROM ".concat(g,"\nWHERE the_geom is not null and admin_scale = 'City'\nORDER BY range"),zIndex:1,props:function(e){var t=e.feature.properties,n=t.municipality,o=t.state,i=t.country;return b(b({},e.feature.properties),{},{jurisdictionName:"".concat(n).concat(o?", ".concat(o):"").concat(i?", ".concat(i):""),jurisdictionType:"City",popupName:n,policyStrength:E[e.feature.properties.range]})},style:function(e){return{color:L[e.properties.range]||O,fillColor:k[e.properties.range]||O,fillOpacity:I,radius:C,weight:T}},pointToLayer:function(e,t){return y.circleMarker(t,v.cities.style(e))}},counties:{name:"Counties",type:"polygon",query:"\nSELECT\n  c.the_geom, c.county, c.state, m.range, \n  m.policy_type, m.policy_summary, m.link, m.range\nFROM ".concat("public.us_county_boundaries"," c\nJOIN ").concat(g," m\nON ST_Intersects(c.the_geom, m.the_geom)\nWHERE m.the_geom IS NOT NULL\n  AND m.admin_scale = 'County'\n  OR m.admin_scale = 'City and County'\nORDER BY m.range"),zIndex:2,props:function(e){var t=e.feature.properties,n=t.state,o=t.county;return b(b({},e.feature.properties),{},{jurisdictionName:"".concat(o).concat(n?", ".concat(n):""),jurisdictionType:"County",popupName:"".concat(o).concat(n?", ".concat(n):""),policyStrength:E[e.feature.properties.range]})},style:function(e){return{color:L[e.properties.range]||O,fillColor:k[e.properties.range]||O,fillOpacity:I,radius:C,weight:T}}},states:{name:"States",type:"polygon",query:"\nSELECT\n  s.the_geom, s.name, s.admin, s.sr_adm0_a3,\n  m.range, m.iso, m .policy_type, m.policy_summary, m.link\nFROM ".concat("public.states_and_provinces_global"," s\nINNER JOIN ").concat(g," m\n  ON s.name = m.state\n  AND s.sr_adm0_a3 = m.iso\n  AND m.admin_scale = 'State'\nORDER BY m.range"),zIndex:3,props:function(e){var t=e.feature.properties,n=t.name,o=t.admin;return b(b(b({},e.feature.properties),e.feature.properties),{},{jurisdictionName:"".concat(n).concat(o?", ".concat(o):""),jurisdictionType:"State/Province",popupName:n,policyStrength:E[e.feature.properties.range]})},style:function(e){return{color:L[e.properties.range]||O,fillColor:k[e.properties.range]||O,fillOpacity:I,radius:C,weight:T}}},nations:{name:"Nations",type:"polygon",query:"\nSELECT \n  c.the_geom, c.adm0_a3, c.name_en, m.range,\n  m.policy_type, m.policy_summary, m.link\nFROM ".concat("public.countries"," c\nINNER JOIN ").concat(g," m\n  ON c.adm0_a3 = m.iso\n  AND m.admin_scale = 'Country'\nORDER BY m.range"),zIndex:4,props:function(e){var t=e.feature.properties.name_en;return b(b({},e.feature.properties),{},{jurisdictionName:t,jurisdictionType:"Country",popupName:t,policyStrength:E[e.feature.properties.range]})},style:function(e){return{color:L[e.properties.range]||O,fillColor:k[e.properties.range]||O,fillOpacity:I,radius:C,weight:T}}},rentStrikes:{name:"Rent Strikes",type:"marker-cluster",query:null,sheetId:"1rCZfNXO3gbl5H3cKhGXKIv3samJ1KC4nLhCwwZqrHvU",zIndex:0,props:function(e){return e.feature.properties},pointToLayer:function(e,t){return y.marker(t,{icon:f})}}};window.mapLayersConfig=v;var O="#939393",k=[void 0,"#d9f0a3","#78c679","#238443"],L=[void 0,"#addd8e","#41ab5d","#005a32"],T=1.5,C=8,I=.7,E=["","Few protections in place","Some protections in place","Many protections in place"],S={lat:40.67,lng:-97.23,z:4,nations:!1,states:!0,cities:!0,counties:!0,rentStrikes:!0},_=Object.keys(v).length,j=function(){return document.querySelector("body").offsetWidth<640};function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}var D=function(){function e(t){var n=this;a()(this,e),p()(this,"dataLayers",new Map),p()(this,"popupTemplate",document.querySelector(".popup-template").innerHTML),p()(this,"rentStrikePopupTemplate",document.querySelector(".rentstrike-popup-template").innerHTML),p()(this,"handleWindowResize",(function(){j()&&n.map.invalidateSize()})),p()(this,"handleInfoWindowClose",(function(){n.map.closePopup(),j()&&n.map.invalidateSize()})),p()(this,"handleAddLayerError",(function(e){console.error(e),n.toggleLoadingIndicator(!1)})),p()(this,"handleAddLayer",(function(e){var t,o,r,a,s=e.key,c=e.layerConfig,l=e.data,u=n;switch(c.type){case"point":t=y.geoJson(l,{pointToLayer:c.pointToLayer});break;case"polygon":t=y.geoJson(l,{style:function(e){return c.style(e)}});break;case"marker-cluster":o={type:"FeatureCollection",features:l.filter((function(e){var t=e.Strike_Status,n=e.Latitude,o=e.Longitude;return null!==t&&null!==o&&null!==n})).map((function(e){var t=e.Strike_Status;return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(Object(n),!0).forEach((function(t){p()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({status:"Yes / Sí / 是 / Oui"===t||"Yes"===t?"Yes":"Unsure"},i()(e,["Strike_Status"]))})).map((function(e,t){var n=e.Longitude,o=e.Latitude;return{type:"Feature",id:t,properties:i()(e,["Longitude","Latitude"]),geometry:{type:"Point",coordinates:[n,o]}}}))},r=y.geoJson(o,{pointToLayer:c.pointToLayer}),(a=y.markerClusterGroup({maxClusterRadius:40}).on("clusterclick",(function(){j()&&h.call("title-details-close")}))).addLayer(r).bindPopup((function(e){return h.call("render-infowindow",null,{template:"rentstrikes",data:e.feature.properties}),d.a.render(u.rentStrikePopupTemplate,c.props(e))})),t=a;break;default:throw Error("Unrecognized map layer type")}"marker-cluster"!==c.type&&t.bindPopup((function(e){var t=c.props(e);return h.call("render-infowindow",null,{template:"protections",data:t}),d.a.render(u.popupTemplate,t)})),n.dataLayers.set(c.name,{layerGroup:t,zIndex:c.zIndex}),n.config[s]&&t.addTo(n.map),n.fixZOrder(),n.handleAllLayersAdded()})),p()(this,"handleAllLayersAdded",(function(){n.dataLayers.size===_&&(n.dataLayers.forEach((function(e,t){var o=e.layerGroup;n.layersControl.addOverlay(o,t)})),n.toggleLoadingIndicator(!1))})),p()(this,"fixZOrder",(function(){Array.from(n.dataLayers.values()).sort((function(e,t){return t.zIndex-e.zIndex})).forEach((function(e){var t=e.layerGroup;n.map.hasLayer(t)&&t.bringToFront()}))})),p()(this,"toggleLoadingIndicator",(function(e){e?h.call("show-loading-indicator"):h.call("hide-loading-indicator")})),this.config=t||S,this.init(),this.bindListeners()}return c()(e,[{key:"init",value:function(){var e=this.config,t=e.lat,n=e.lng,o=e.z;this.map=y.map("map",{zoomControl:!1,attributionControl:!1,maxBounds:[[-85.05,-190],[85.05,200]]}),this.map.setView([t,n],o),this.attributionControl=y.control.attribution({prefix:"Data sources by: "}).addAttribution("<a href='https://www.antievictionmap.com/' target='_blank'>Anti-Eviction Mapping Project</a>").addAttribution("<a href='https://www.openstreetmap.org' target='_blank'>Open Street Map Contributors</a>").addTo(this.map),this.zoomControl=y.control.zoom({position:"bottomright"}).addTo(this.map),this.layersControl=y.control.layers(null,null,{position:"topright",collapsed:!1}).addTo(this.map),this.basemapLayer=y.tileLayer("https://a.basemaps.cartocdn.com/rastertiles/light_all/{z}/{x}/{y}@2x.png",{minZoom:1,maxZoom:18}).addTo(this.map)}},{key:"bindListeners",value:function(){var e,t=this,n=this;this.map.on("popupopen",(function(e){document.getElementById("root").classList.add("aemp-popupopen"),j()&&(h.call("title-details-close"),n.map.invalidateSize()),n.map.setView(e.popup._latlng,n.map.getZoom(),{animate:!0})})),this.map.on("popupclose",(function(){document.getElementById("root").classList.remove("aemp-popupopen"),h.call("close-infowindow"),j()&&setTimeout((function(){n.map.invalidateSize()}),100)})),this.map.on("click",(function(){j()&&h.call("title-details-close")})),this.map.on("overlayadd",(function(){t.fixZOrder()})),window.addEventListener("resize",(function(){clearTimeout(e),e=setTimeout(n.handleWindowResize,250)})),h.on("close-infowindow.map",this.handleInfoWindowClose),h.on("fetch-map-data-resolve.map",this.handleAddLayer),h.on("fetch-map-data-reject.map",this.handleLayerError)}}]),e}(),N=function(){function e(){var t=this;a()(this,e),p()(this,"infowindowContainer",document.getElementById("aemp-infowindow-container")),p()(this,"infowindowTemplate",document.getElementById("aemp-infowindow-template").innerHTML),p()(this,"rentStrikeInfowindowTemplate",document.getElementById("aemp-rentstrike-infowindow-template").innerHTML),p()(this,"closeInfoWindow",(function(){document.getElementById("root").classList.remove("aemp-popupopen"),t.infowindowContainer.innerHTML=null})),p()(this,"render",(function(e){var n=e.template,o=e.data;switch(n){case"protections":t.infowindowContainer.innerHTML=d.a.render(t.infowindowTemplate,o);break;case"rentstrikes":t.infowindowContainer.innerHTML=d.a.render(t.rentStrikeInfowindowTemplate,o)}t.infowindowContainer.querySelector(".aemp-infowindow-close").addEventListener("click",(function(){return h.call("close-infowindow")})),document.getElementById("root").classList.add("aemp-popupopen")})),this.bindListeners()}return c()(e,[{key:"bindListeners",value:function(){h.on("render-infowindow",this.render),h.on("close-infowindow.self",this.closeInfoWindow)}}]),e}(),z=function(){function e(){var t=this;a()(this,e),p()(this,"loadingContainer",document.getElementById("loading-container")),p()(this,"show",(function(){t.loadingContainer.hidden=!1})),p()(this,"hide",(function(){t.loadingContainer.hidden=!0})),this.bindListeners()}return c()(e,[{key:"bindListeners",value:function(){h.on("show-loading-indicator",this.show),h.on("hide-loading-indicator",this.hide)}}]),e}(),P=(n("T63A"),n("5s+n"),n("J4zp")),R=n.n(P),B=n("o0o1"),M=n.n(B),q=(n("ls82"),n("yXPU")),A=n.n(q),J=(n("bZMm"),n("Vibt")),W=n("6hg5"),Z="https://".concat("ampitup",".carto.com/api/v2/sql");function F(e,t){h.call(e,null,t)}function U(e,t){h.call(e,null,t)}function H(e){return Y.apply(this,arguments)}function Y(){return(Y=A()(M.a.mark((function e(t){var n,o,i=arguments;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:"geojson",e.next=3,fetch("".concat(Z,"?q=").concat(window.encodeURIComponent(t),"&format=").concat(n));case 3:if((o=e.sent)&&o.ok){e.next=6;break}throw Error("Unable to fetch Carto data");case 6:return e.abrupt("return",o.json());case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function G(e){return K.apply(this,arguments)}function K(){return(K=A()(M.a.mark((function e(t){var n,o;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://docs.google.com/spreadsheets/d/".concat(t,"/export?format=csv&id=").concat(t));case 2:if((n=e.sent)&&n.ok){e.next=5;break}throw Error("Unable to fetch sheets data");case 5:return e.next=7,n.text();case 7:return o=e.sent,e.abrupt("return",Object(J.a)(o,W.a));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(){return(V=A()(M.a.mark((function e(){return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Object.entries(v).forEach(function(){var e=A()(M.a.mark((function e(t){var n,o,i,r;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=R()(t,2),o=n[0],i=n[1],e.prev=1,null===i.query){e.next=8;break}return e.next=5,H(i.query);case 5:e.t0=e.sent,e.next=11;break;case 8:return e.next=10,G(i.sheetId);case 10:e.t0=e.sent;case 11:r=e.t0,F("fetch-map-data-resolve",{key:o,layerConfig:i,data:r}),e.next=18;break;case 15:e.prev=15,e.t1=e.catch(1),U("fetch-map-data-reject",e.t1);case 18:case"end":return e.stop()}}),e,null,[[1,15]])})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}n("+2oP"),n("rB9j"),n("EnZy");new D(function(e){for(var t=window.location.hash.slice(1).split("&"),n={},o=0;o<t.length;o++){var i=t[o].split("="),r=R()(i,2),a=r[0],s=r[1];n[a]=s}isNaN(n.z)||(e.z=parseInt(n.z)),isNaN(n.lat)||(e.lat=parseFloat(n.lat)),isNaN(n.lng)||(e.lng=parseFloat(n.lng)),void 0!==n.cities&&("true"===n.cities?e.cities=!0:"false"===n.cities&&(e.cities=!1)),void 0!==n.counties&&("true"===n.counties?e.counties=!0:"false"===n.counties&&(e.counties=!1)),void 0!==n.states&&("true"===n.states?e.states=!0:"false"===n.states&&(e.states=!1)),void 0!==n.nations&&("true"===n.nations?e.nations=!0:"false"===n.nations&&(e.nations=!1)),void 0!==n.rentstrike&&("true"===n.rentstrike?e.rentStrikes=!0:"false"===n.rentstrike&&(e.rentStrikes=!1))}(S)),new N,new function e(){var t=this;a()(this,e),p()(this,"titleDetails",document.getElementById("aemp-titlebox").querySelector("details")),p()(this,"bindListeners",(function(){t.titleDetails.addEventListener("toggle",(function(){this.open?document.getElementById("aemp-titlebox").classList.remove("collapsed"):document.getElementById("aemp-titlebox").classList.add("collapsed")})),h.on("title-details-toggle",t.toggleTitleDetails),h.on("title-details-open",t.openTitleDetails),h.on("title-details-close",t.closeTitleDetails)})),p()(this,"closeTitleDetails",(function(){t.titleDetails.open=!1})),p()(this,"openTitleDetails",(function(){t.titleDetails.open=!0})),p()(this,"toggleTitleDetails",(function(){t.titleDetails.open?t.titleDetails.open=!1:t.titleDetails.open=!0})),this.bindListeners()},new z,function(){V.apply(this,arguments)}()}},[["tjUo",1,2]]]);
//# sourceMappingURL=index.3258d5ed971510aaa0b8.js.map